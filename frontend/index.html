<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Energy Consumption</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h1>Real-Time Computer Energy Consumption</h1>
  <div id="energyChart" style="width:100%; max-width:800px; height:500px;"></div>

  <script>
    const timeData = [];
    const cpuData = [];
    const ramData = [];
    const diskData = [];
    const totalData = [];

    async function fetchMetrics() {
      try {
        const response = await fetch("http://127.0.0.1:5000/metrics");
        const data = await response.json();

        // Add new data to arrays
        timeData.push(data.time);
        cpuData.push(data.cpu_usage);
        ramData.push(data.ram_usage);
        diskData.push(data.disk_usage);
        totalData.push(data.total_consumption);

        // Keep only the last 50 points for better performance
        if (timeData.length > 50) {
          timeData.shift();
          cpuData.shift();
          ramData.shift();
          diskData.shift();
          totalData.shift();
        }

        // Update the graph
        Plotly.update("energyChart", {
          x: [timeData, timeData, timeData, timeData],
          y: [cpuData, ramData, diskData, totalData]
        });
      } catch (error) {
        console.error("Error fetching metrics:", error);
      }
    }

    // Initialize the plot with empty data
    Plotly.newPlot("energyChart", [
      { x: timeData, y: cpuData, mode: 'lines', name: 'CPU Usage (%)', line: { color: 'blue' } },
      { x: timeData, y: ramData, mode: 'lines', name: 'RAM Usage (%)', line: { color: 'green' } },
      { x: timeData, y: diskData, mode: 'lines', name: 'Disk Usage (%)', line: { color: 'red' } },
      { x: timeData, y: totalData, mode: 'lines', name: 'Total Consumption (%)', line: { color: 'black', dash: 'dash' } }
    ], {
      title: 'Computer Energy Consumption Over Time',
      xaxis: { title: 'Time' },
      yaxis: { title: 'Usage (%)' }
    });

    // Fetch metrics every 5 seconds
    setInterval(fetchMetrics, 5000);
  </script>
</body>
</html>
