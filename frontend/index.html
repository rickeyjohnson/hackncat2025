<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Energy Consumption</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h1>Real-Time Database Energy Consumption</h1>
  <div id="energyConsumptionChart" style="width:100%; max-width:800px; height:500px;"></div>

  <script>
    // Initialize empty data arrays
    const timeData = [];
    const cpuData = [];
    const ramData = [];
    const storageData = [];
    const totalData = [];

    async function fetchMetrics() {
      try {
        const response = await fetch("http://127.0.0.1:5000/metrics");
        const data = await response.json();

        // Push new data points
        timeData.push(data.time);
        cpuData.push(data.cpu_usage);
        ramData.push(data.ram_usage);
        storageData.push(data.storage_usage);
        totalData.push(data.total_consumption);

        // Keep only the last 50 points for smoother graphing
        if (timeData.length > 50) {
          timeData.shift();
          cpuData.shift();
          ramData.shift();
          storageData.shift();
          totalData.shift();
        }

        // Update the graph with new data
        Plotly.update("energyConsumptionChart", {
          x: [timeData, timeData, timeData, timeData],
          y: [cpuData, ramData, storageData, totalData]
        });
      } catch (error) {
        console.error("Error fetching metrics:", error);
      }
    }

    // Initialize the plot with empty data
    Plotly.newPlot("energyConsumptionChart", [
      { x: timeData, y: cpuData, mode: 'lines', name: 'CPU Watts', line: { color: 'blue' } },
      { x: timeData, y: ramData, mode: 'lines', name: 'RAM Watts', line: { color: 'green' } },
      { x: timeData, y: storageData, mode: 'lines', name: 'Storage Watts', line: { color: 'red' } },
      { x: timeData, y: totalData, mode: 'lines', name: 'Total Consumption', line: { color: 'black', dash: 'dash' } }
    ], {
      title: 'Real-Time Energy Consumption',
      xaxis: { title: 'Time' },
      yaxis: { title: 'Power Consumption (Watts)' }
    });

    // Fetch metrics every 5 seconds
    setInterval(fetchMetrics, 5000);
  </script>
</body>
</html>